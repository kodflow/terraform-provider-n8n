# Automatic Documentation Scripts

This directory contains scripts to automatically generate project documentation.

## ğŸ“ generate-changelog.sh

### Description

Automatically generates the `CHANGELOG.md` file based on Git history using **Conventional Commits** conventions.

### Usage

```bash
# Generate changelog for current branch
./scripts/generate-changelog.sh

# Specify source branch and base branch
./scripts/generate-changelog.sh feat/my-branch main
```

### Or via Makefile

```bash
make changelog
```

### Commit Format

The script recognizes the following commit types:

| Type        | Emoji | Category      | Example                    |
| ----------- | ----- | ------------- | -------------------------- |
| `feat:`     | ğŸš€    | Features      | `feat: add new resource`   |
| `fix:`      | ğŸ›    | Bug Fixes     | `fix: resolve nil pointer` |
| `test:`     | âœ…    | Tests         | `test: add unit tests`     |
| `docs:`     | ğŸ“š    | Documentation | `docs: update README`      |
| `refactor:` | â™»ï¸    | Refactoring   | `refactor: simplify logic` |
| `perf:`     | âš¡    | Performance   | `perf: optimize query`     |
| `build:`    | ğŸ”§    | Build         | `build: update Bazel`      |
| `ci:`       | ğŸ¤–    | CI/CD         | `ci: add workflow`         |
| `chore:`    | ğŸ”¨    | Chore         | `chore: update deps`       |
| `style:`    | ğŸ’„    | Style         | `style: format code`       |

### Features

- âœ… Automatic categorization by commit type
- âœ… Short hashes for traceability
- âœ… Statistics (number of commits by type)
- âœ… Integration with COVERAGE.MD (displays coverage rate)
- âœ… Contributors list
- âœ… Generation timestamp

### Output

The generated file follows the [Keep a Changelog](https://keepachangelog.com/) format:

```markdown
# Changelog

All notable changes to this project will be documented in this file.

## [Unreleased]

### ğŸš€ Features

- comprehensive test coverage improvements (`5d3466b`)

### ğŸ› Bug Fixes

- resolve critical linter issues (`5abf916`)

---

### ğŸ“Š Statistics

- **Total commits:** 30
- **Features:** 7
- **Test coverage:** 70.9%

### ğŸ‘¥ Contributors

- Florent <contact@making.codes>
```

## ğŸ”„ Automation

### Git Hooks Configuration

Git hooks are stored in **`.devcontainer/hooks/`** and integrated into the Docker image with correct permissions.

**Advantages:**

- âœ… **Versioned**: Source in `.devcontainer/hooks/` tracked in git
- âœ… **Maintainable**: Edit in `.devcontainer/hooks/`, rebuild to apply
- âœ… **Synchronized**: Entire team uses the same hooks with correct permissions
- âœ… **GUI Compatible**: Works with GitKraken, SourceTree, etc. without permission issues
- âœ… **Cross-platform**: Permissions fixed in Docker image, no chmod needed

Hooks are **automatically configured** during devcontainer rebuild and copied to `$HOME/.git-hooks/`.

If you need to reconfigure them manually:

```bash
./scripts/install-hooks.sh
```

Or directly:

```bash
git config core.hooksPath $HOME/.git-hooks
```

Available hooks in `$HOME/.git-hooks/` (source: `.devcontainer/hooks/`):

1. **pre-commit**: Automatically generates CHANGELOG.md and coverage report
2. **prepare-commit-msg**: Suggests conventional commits format
3. **commit-msg**: Validates message with commitlint
4. **pre-push**: Blocks push if AI mentions or Co-Authored-By are detected

### Automatic DevContainer Configuration

Hooks are automatically configured during devcontainer rebuild via `.devcontainer/post-create.sh` which executes `./scripts/install-hooks.sh`

### Dependencies

For commit validation, commitlint must be installed:

```bash
npm install -g @commitlint/cli @commitlint/config-conventional
```

This dependency is automatically installed in the devcontainer.

### Commit Validation (Pre-Push)

The **pre-push** hook prevents pushing commits containing AI mentions or unwanted Co-Authored-By.

**Detected keywords (case insensitive):**

- `claude`, `chatgpt`, `gpt-`, `copilot`
- `ai generated`, `generated by ai`, `generated with ai`
- `with the help of`, `assisted by`
- `co-authored-by: claude`, `co-authored-by: github-actions`, `co-authored-by: bot`
- Robot emoji `ğŸ¤–`

**If a problematic commit is detected:**

```bash
âŒ Found commits with AI mentions or Co-Authored-By:

  Commit: abc123 - "feat: add new feature"
  Found: 'co-authored-by: claude' in commit message

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âŒ Push rejected!
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Commits to fix:
  abc123 - feat: add new feature

To fix these commits, use one of the following methods:

1. Interactive rebase to edit commit messages:
   git rebase -i HEAD~N  (where N is the number of commits)
   Change 'pick' to 'reword' for the problematic commits

2. Amend the last commit (if it's the most recent):
   git commit --amend

3. Filter commits to remove AI mentions:
   git filter-branch --msg-filter 'sed "s/Co-Authored-By.*//g"' HEAD~N..HEAD
```

**To fix a commit:**

```bash
# If it's the last commit
git commit --amend
git push --force-with-lease

# If it's an old commit
git rebase -i HEAD~5  # Replace 5 with number of commits
# Change 'pick' to 'reword' for commits to modify
git push --force-with-lease
```

**To bypass temporarily (NOT recommended):**

```bash
git push --no-verify
```

### GitHub Actions

Example workflow to generate changelog in CI/CD:

```yaml
name: Update Documentation

on:
  push:
    branches: [main, develop]

jobs:
  docs:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0 # Important for complete Git history

      - name: Generate Changelog
        run: |
          chmod +x ./scripts/generate-changelog.sh
          ./scripts/generate-changelog.sh

      - name: Commit changes
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"
          git add CHANGELOG.md
          git commit -m "docs: update changelog [skip ci]" || true
          git push
```

## ğŸ“Š Makefile Integration

The Makefile provides convenient commands:

```bash
# Generate only changelog
make changelog

# Generate coverage report
make coverage-report

# Generate all documentation
make docs
```

## ğŸ¯ Best Practices

1. **Conventional commits**: Always use the format `type: description`
2. **Regular generation**: Run `make changelog` before each PR
3. **Review**: Check generated changelog for consistency
4. **Versioning**: Update `[Unreleased]` to release version when creating tags

## ğŸ“š References

- [Conventional Commits](https://www.conventionalcommits.org/)
- [Keep a Changelog](https://keepachangelog.com/)
- [Semantic Versioning](https://semver.org/)
