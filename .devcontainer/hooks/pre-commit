#!/bin/bash
# Pre-commit hook to auto-generate documentation files
# - CHANGELOG.md (from git history)
# - COVERAGE.MD (from test coverage)

set -e

echo "ğŸ”„ Generating documentation files..."

# Generate CHANGELOG.md
if [ -f "./scripts/generate-changelog.sh" ]; then
    echo "ğŸ“ Generating CHANGELOG.md..."
    ./scripts/generate-changelog.sh > /dev/null 2>&1
    git add CHANGELOG.md
    echo "âœ… CHANGELOG.md updated"
fi

# Generate coverage report
echo "ğŸ“Š Running tests for coverage..."
if go test -coverprofile=coverage.out ./src/internal/provider/... > /dev/null 2>&1; then
    echo "âœ… Coverage data collected"
    # Clean up coverage file (not needed in git)
    rm -f coverage.out
else
    echo "âš ï¸  Some tests failed, but continuing commit"
fi

echo "âœ… Documentation files ready"
exit 0
