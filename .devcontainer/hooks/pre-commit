#!/bin/bash
# Copyright (c) 2024 Florent (Kodflow). All rights reserved.
# Licensed under the Sustainable Use License 1.0
# See LICENSE.md in the project root for license information.

# Pre-commit hook to add copyright headers and generate documentation

set -e

# Colors
CYAN='\033[36m'
GREEN='\033[32m'
YELLOW='\033[33m'
RED='\033[31m'
RESET='\033[0m'
BOLD='\033[1m'

echo ""
echo -e "${BOLD}${CYAN}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${RESET}"
echo -e "${BOLD}  Pre-commit checks${RESET}"
echo -e "${BOLD}${CYAN}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${RESET}"
echo ""

# Add copyright headers to modified files
echo -e "${BOLD}1. Adding copyright headers...${RESET}"
if ! ./scripts/add-copyright-headers.sh; then
  echo -e "${RED}✗${RESET} Failed to add copyright headers"
  exit 1
fi
echo ""

# Generate documentation (CHANGELOG.md and COVERAGE.MD)
echo -e "${BOLD}2. Generating documentation...${RESET}"
./scripts/generate-changelog.sh > /dev/null 2>&1
./scripts/generate-coverage.sh > /dev/null 2>&1

# Stage documentation files if they were modified
if [ -f "CHANGELOG.md" ]; then
  git add CHANGELOG.md
fi
if [ -f "COVERAGE.MD" ]; then
  git add COVERAGE.MD
fi
echo -e "${GREEN}✓${RESET} Documentation updated"
echo ""

echo -e "${BOLD}${CYAN}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${RESET}"
echo -e "${BOLD}${GREEN}✓${RESET} Pre-commit checks passed${RESET}"
echo -e "${BOLD}${CYAN}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${RESET}"
echo ""
